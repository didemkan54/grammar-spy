<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Grammar Spy™ — Community</title>
<meta name="description" content="Teacher-to-teacher ideas that make grammar stick. Weekly prompts, mission tips, and teacher spotlights."/>
<link rel="icon" type="image/svg+xml" href="assets/brand/favicon.svg"/>
<style>
:root{--bg:#f6fafa;--panel:#fff;--text:#1a2b2c;--muted:#5e7172;--teal:#1f5f63;--teal-2:#e6f2f2;--teal-3:#cce5e6;--gold:#c9a227;--gold-2:#fdf8eb;--red:#b04444;--green:#1f8f63;--green-2:#eaf8ef;--border:#d4e0e0;--shadow:0 4px 20px rgba(20,60,62,.06);--radius:14px;--focus:0 0 0 3px rgba(31,95,99,.35)}
*{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth;scroll-padding-top:120px}
body{background:var(--bg);color:var(--text);font-family:Inter,"Segoe UI",system-ui,sans-serif;line-height:1.65;-webkit-font-smoothing:antialiased}
::selection{background:var(--teal-2);color:var(--teal)}
:focus-visible{outline:none;box-shadow:var(--focus);border-radius:4px}
.wrap{max-width:1000px;margin:0 auto;padding:0 24px}

/* HERO */
.hero{padding:48px 24px 32px;text-align:center}
.hero h1{font-size:clamp(28px,4.5vw,40px);font-weight:800;color:var(--text);letter-spacing:-.02em}
.hero .sub{font-size:16px;color:var(--muted);margin:10px auto 0;max-width:48ch}
.hero-cta{display:flex;justify-content:center;gap:12px;margin-top:24px;flex-wrap:wrap}
.hero .phase{font-size:12px;color:var(--muted);margin-top:16px;font-style:italic}
.btn{display:inline-flex;align-items:center;justify-content:center;padding:11px 22px;border-radius:10px;font-size:14px;font-weight:700;text-decoration:none;letter-spacing:.02em;cursor:pointer;border:0;transition:transform .15s,box-shadow .15s}
.btn-primary{background:var(--teal);color:#fff;box-shadow:0 2px 12px rgba(31,95,99,.18)}
.btn-primary:hover{transform:translateY(-1px);filter:brightness(1.08)}
.btn-secondary{background:var(--panel);color:var(--teal);border:1.5px solid var(--border);box-shadow:var(--shadow)}
.btn-secondary:hover{border-color:var(--teal);background:var(--teal-2)}
.btn-sm{padding:7px 14px;font-size:12px;border-radius:8px}
.btn-gold{background:var(--gold);color:#fff}

/* FILTER BAR */
.filter-bar{position:sticky;top:0;z-index:50;background:rgba(246,250,250,.94);backdrop-filter:blur(10px);border-bottom:1px solid var(--border);padding:12px 0}
.filter-inner{max-width:1000px;margin:0 auto;padding:0 24px;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.chip{padding:6px 14px;border:1px solid var(--border);border-radius:20px;background:var(--panel);font:600 12px Inter,sans-serif;color:var(--muted);cursor:pointer;transition:all .15s;white-space:nowrap}
.chip:hover,.chip.active{background:var(--teal);color:#fff;border-color:var(--teal)}
.filter-search{flex:1;min-width:180px;position:relative}
.filter-search input{width:100%;padding:8px 12px 8px 34px;border:1px solid var(--border);border-radius:10px;font:inherit;font-size:13px;color:var(--text);background:var(--panel)}
.filter-search input:focus{border-color:var(--teal);box-shadow:var(--focus)}
.filter-search svg{position:absolute;left:10px;top:50%;transform:translateY(-50%);width:15px;height:15px;color:var(--muted);pointer-events:none}
.filter-sort{padding:7px 10px;border:1px solid var(--border);border-radius:8px;font:600 12px Inter,sans-serif;color:var(--muted);background:var(--panel);cursor:pointer}
.count{font-size:12px;color:var(--muted);font-weight:600;margin-left:auto}

/* SECTION */
.section{padding:40px 0}
.section-title{font-size:22px;font-weight:800;color:var(--text);margin-bottom:4px}
.section-sub{font-size:14px;color:var(--muted);margin-bottom:20px}
.kicker{font-size:11px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--teal);margin-bottom:6px}

/* POST CARD */
.post-card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow);margin-bottom:14px;transition:transform .15s}
.post-card:hover{transform:translateY(-1px)}
.post-tags{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:8px}
.tag{font-size:10px;font-weight:700;letter-spacing:.06em;text-transform:uppercase;padding:3px 8px;border-radius:6px}
.tag-prompt{background:#e0f0ff;color:#1a5fa0}
.tag-tip{background:var(--teal-2);color:var(--teal)}
.tag-spotlight{background:var(--gold-2);color:#8a6d10}
.tag-announce{background:#f0e6ff;color:#6a2dba}
.tag-mission{background:#e8f5e0;color:#2d7a2d}
.tag-grade{background:#f0f0f0;color:#555}
.post-title{font-size:17px;font-weight:700;color:var(--text);margin-bottom:6px;line-height:1.3}
.post-excerpt{font-size:14px;color:var(--muted);line-height:1.55;margin-bottom:10px}
.post-meta{display:flex;gap:16px;align-items:center;font-size:12px;color:var(--muted);flex-wrap:wrap}
.post-meta svg{width:14px;height:14px;vertical-align:middle;margin-right:3px}
.post-action{display:inline-flex;align-items:center;gap:4px;cursor:pointer;transition:color .15s}
.post-action:hover{color:var(--teal)}
.post-body{display:none;margin-top:16px;padding-top:16px;border-top:1px solid var(--border);font-size:14px;line-height:1.7;color:var(--text)}
.post-body.open{display:block}

/* COMMENTS */
.comments{margin-top:16px;padding-top:12px;border-top:1px solid var(--border)}
.comment{padding:10px 0;border-bottom:1px solid #f0f3f3;font-size:13px}
.comment-author{font-weight:700;color:var(--teal);font-size:12px}
.comment-text{color:var(--muted);margin-top:2px}
.comment-time{font-size:11px;color:#a0adb0;margin-top:2px}
.comment-form{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
.comment-form input,.comment-form textarea{flex:1;min-width:160px;padding:8px 12px;border:1px solid var(--border);border-radius:8px;font:inherit;font-size:13px;resize:none}
.comment-form textarea{min-height:60px}
.load-more{font-size:12px;color:var(--teal);font-weight:600;cursor:pointer;margin-top:8px;background:none;border:0}
.load-more:hover{text-decoration:underline}

/* TIP CARD */
.tip-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px}
.tip-card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);transition:transform .15s}
.tip-card:hover{transform:translateY(-1px)}
.tip-title{font-size:15px;font-weight:700;color:var(--text);margin:8px 0 4px}
.tip-content{font-size:13px;color:var(--muted);line-height:1.55}
.tip-author{font-size:11px;color:var(--muted);margin-top:8px;font-style:italic}
.tip-actions{display:flex;gap:10px;margin-top:10px;align-items:center}
.helpful-btn,.save-btn{display:inline-flex;align-items:center;gap:4px;padding:5px 10px;border:1px solid var(--border);border-radius:8px;background:var(--panel);font:600 11px Inter,sans-serif;color:var(--muted);cursor:pointer;transition:all .15s}
.helpful-btn:hover,.helpful-btn.active{background:var(--green-2);border-color:var(--green);color:var(--green)}
.save-btn:hover,.save-btn.active{background:var(--gold-2);border-color:var(--gold);color:var(--gold)}
.helpful-btn svg,.save-btn svg{width:14px;height:14px}

/* SPOTLIGHT */
.spotlight-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px}
.spotlight-card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow)}
.spotlight-avatar{width:48px;height:48px;border-radius:50%;background:var(--teal-2);display:flex;align-items:center;justify-content:center;font:700 18px Inter,sans-serif;color:var(--teal);margin-bottom:10px}
.spotlight-name{font-size:15px;font-weight:700;color:var(--text)}
.spotlight-list{list-style:none;padding:0;margin:10px 0 0}
.spotlight-list li{font-size:13px;color:var(--muted);padding:4px 0;padding-left:16px;position:relative}
.spotlight-list li::before{content:"✓";position:absolute;left:0;color:var(--teal);font-weight:700}

/* GUIDELINES */
.guidelines{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:24px;margin-top:40px;margin-bottom:40px}
.guidelines h3{font-size:16px;font-weight:700;color:var(--text);margin-bottom:10px}
.guidelines ul{padding-left:18px;color:var(--muted);font-size:13px}
.guidelines li{margin-top:6px}

/* MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(11,16,32,.4);backdrop-filter:blur(6px);display:none;place-items:center;z-index:200;padding:20px}
.modal-overlay.open{display:grid}
.modal{background:var(--panel);border-radius:var(--radius);box-shadow:0 20px 50px rgba(20,60,62,.15);padding:28px;max-width:520px;width:100%;max-height:90vh;overflow-y:auto}
.modal h2{font-size:22px;font-weight:800;color:var(--text);margin-bottom:4px}
.modal p{font-size:14px;color:var(--muted);margin-bottom:16px}
.modal .field{margin-bottom:14px}
.modal label{display:block;font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:.06em;color:var(--muted);margin-bottom:4px}
.modal input,.modal textarea,.modal select{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px;font:inherit;font-size:14px;color:var(--text)}
.modal textarea{min-height:100px;resize:vertical}
.modal-actions{display:flex;gap:10px;margin-top:16px}
.modal .close-btn{position:absolute;top:12px;right:12px;background:none;border:0;font-size:20px;color:var(--muted);cursor:pointer}
.char-count{font-size:11px;color:var(--muted);text-align:right;margin-top:2px}

/* TOAST */
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--teal);color:#fff;padding:12px 24px;border-radius:10px;font:600 14px Inter,sans-serif;box-shadow:0 6px 20px rgba(31,95,99,.25);opacity:0;visibility:hidden;transition:all .3s;z-index:300}
.toast.show{opacity:1;visibility:visible;transform:translateX(-50%) translateY(0)}

/* EMPTY */
.empty{text-align:center;padding:40px;color:var(--muted);font-size:14px}

/* REPORT LINK */
.report-link{font-size:11px;color:#a0adb0;cursor:pointer;margin-left:auto}
.report-link:hover{color:var(--red)}

@media(max-width:600px){.tip-grid,.spotlight-grid{grid-template-columns:1fr}.hero h1{font-size:28px}}
</style>
</head>
<body>
<script src="i18n.js"></script>
<div data-include="header"></div>

<!-- HERO -->
<header class="hero">
<div class="wrap">
<h1>Community</h1>
<p class="sub">Teacher-to-teacher ideas that make grammar stick.</p>
<div class="hero-cta">
<button class="btn btn-primary" onclick="openModal('tipModal')">Share a Tip</button>
<a href="#discussions" class="btn btn-secondary">Browse Discussions</a>
</div>
<p class="phase">Phase 1: curated prompts + shared tips. Full forums coming later.</p>
</div>
</header>

<!-- FILTER BAR -->
<div class="filter-bar" id="filterBar">
<div class="filter-inner">
<button class="chip active" data-filter="all">All</button>
<button class="chip" data-filter="prompt">Weekly Prompts</button>
<button class="chip" data-filter="tip">Mission Tips</button>
<button class="chip" data-filter="spotlight">Teacher Spotlights</button>
<button class="chip" data-filter="announce">Announcements</button>
<div class="filter-search">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
<input type="search" id="searchInput" placeholder="Search prompts, tips, missions…" aria-label="Search">
</div>
<select class="filter-sort" id="sortSelect" aria-label="Sort">
<option value="newest">Newest</option>
<option value="helpful">Most Helpful</option>
<option value="discussed">Most Discussed</option>
</select>
<span class="count" id="resultCount"></span>
</div>
</div>

<main class="wrap">

<!-- WEEKLY PROMPTS -->
<section class="section" id="discussions">
<p class="kicker">Weekly Prompts</p>
<h2 class="section-title">This Week's Discussion</h2>
<p class="section-sub">Join the conversation. Share what's working and what's tricky.</p>
<div id="promptCards"></div>
</section>

<!-- MISSION TIPS -->
<section class="section" id="tips">
<p class="kicker">Mission Tips</p>
<h2 class="section-title">Teacher Tips by Mission</h2>
<p class="section-sub">Short, practical ideas submitted by teachers like you.</p>
<div class="tip-grid" id="tipCards"></div>
</section>

<!-- TEACHER SPOTLIGHTS -->
<section class="section" id="spotlights">
<p class="kicker">Teacher Spotlights</p>
<h2 class="section-title">What Worked This Week</h2>
<p class="section-sub">Real teachers, real classrooms, real wins.</p>
<div class="spotlight-grid" id="spotlightCards"></div>
</section>

<!-- GUIDELINES -->
<div class="guidelines">
<h3>Community Guidelines</h3>
<ul>
<li><strong>Stay professional.</strong> This is a space for educators.</li>
<li><strong>No student names.</strong> Protect student privacy at all times.</li>
<li><strong>Be specific and helpful.</strong> "This worked because…" beats "Great job!"</li>
<li><strong>Assume good intent.</strong> We're all here to get better at this.</li>
</ul>
</div>
</main>

<!-- SHARE TIP MODAL -->
<div class="modal-overlay" id="tipModal">
<div class="modal" style="position:relative">
<button class="close-btn" onclick="closeModal('tipModal')">&times;</button>
<h2>Share a Tip</h2>
<p>What's one thing that worked in your classroom? Keep it short and practical.</p>
<div class="field"><label for="tipTitle">Tip Title</label><input id="tipTitle" placeholder="e.g., How I use Error Detector for warm-ups" maxlength="80"></div>
<div class="field"><label for="tipMission">Mission</label><select id="tipMission"><option value="">Select a mission…</option><option>Past Tense (Mission 01)</option><option>Present Tense (Mission 02)</option><option>Be-Verb Agreement (Mission 03)</option><option>Connectors (Mission 04)</option><option>Pronouns (Mission 05)</option><option>Questions (Mission 06)</option><option>General / All Missions</option></select></div>
<div class="field"><label for="tipContent">Your Tip</label><textarea id="tipContent" maxlength="500" placeholder="Describe what you did, why it worked, and any setup tips…" oninput="document.getElementById('tipCharCount').textContent=this.value.length+'/500'"></textarea><div class="char-count" id="tipCharCount">0/500</div></div>
<div class="field"><label for="tipGrade">Grade Band (optional)</label><select id="tipGrade"><option value="">Any grade</option><option>Grades 5-6</option><option>Grades 7-8</option><option>Grades 9-10</option><option>Grades 11-12</option></select></div>
<div class="field" style="display:flex;align-items:center;gap:8px"><input type="checkbox" id="tipFeature" style="width:auto"><label for="tipFeature" style="margin:0;text-transform:none;font-size:13px;color:var(--muted)">Can we feature you in a Teacher Spotlight?</label></div>
<input type="text" id="tipHoney" style="position:absolute;left:-9999px" tabindex="-1" autocomplete="off">
<div class="modal-actions"><button class="btn btn-primary" onclick="submitTip()">Submit Tip</button><button class="btn btn-secondary" onclick="closeModal('tipModal')">Cancel</button></div>
</div>
</div>

<!-- REPORT MODAL -->
<div class="modal-overlay" id="reportModal">
<div class="modal" style="position:relative">
<button class="close-btn" onclick="closeModal('reportModal')">&times;</button>
<h2>Report Content</h2>
<p>We take reports seriously. Tell us what happened and we'll review it.</p>
<div class="field"><label for="reportText">What's the issue?</label><textarea id="reportText" maxlength="500" placeholder="Describe the concern…"></textarea></div>
<div class="modal-actions"><button class="btn btn-primary" onclick="submitReport()">Submit Report</button><button class="btn btn-secondary" onclick="closeModal('reportModal')">Cancel</button></div>
</div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<div data-include="footer"></div>
<script src="billing-scaffold.js"></script>
<script src="auth-scaffold.js"></script>
<script src="layout-loader.js"></script>
<script src="app-shell.js"></script>
<script>
var POSTS=[
{id:"p1",type:"prompt",title:"How do you introduce past tense to newcomers?",excerpt:"Most ELD students can recognize past tense in isolation — but struggle to use it in connected speech. What's your opening move?",body:"This week's discussion: Past tense is one of the first grammar targets in ELD, but it's also one of the hardest to make stick. Students memorize 'walked' and 'talked' but freeze when retelling a story.\n\nWhat's your best opening activity for past tense? Do you start with regular verbs? Timelines? Story retelling? Share what works — and what didn't.",tags:["past tense","ELD","newcomers"],missionTag:"Mission 01",gradeBand:"Grades 6-8",createdAt:"2026-02-24",commentCount:12,helpfulCount:28,comments:[{author:"Ms. Rivera",text:"I always start with a timeline on the board. Students physically walk to 'yesterday' and act out what happened. Then we write it.",time:"2 days ago"},{author:"Mr. Chen",text:"Story retelling with picture cards. They arrange the pictures first, then tell what happened using past tense verbs.",time:"1 day ago"},{author:"Ms. Okafor",text:"Error Detector on Grammar Spy has been great for this. Students catch the errors themselves instead of me correcting them.",time:"5 hours ago"}]},
{id:"p2",type:"prompt",title:"What's your go-to strategy for subject-verb agreement with ELLs?",excerpt:"'The students was…' — we've all heard it. How do you build lasting agreement habits without endless correction?",body:"Subject-verb agreement errors are persistent with ELD students, especially with irregular subjects (none of, each, collective nouns). Correction alone doesn't fix it.\n\nWhat strategies have you found that actually build the habit? Do you use visual cues? Sentence frames? Grammar Spy missions? Let's share what's working.",tags:["agreement","be-verbs","strategies"],missionTag:"Mission 03",gradeBand:"Grades 7-10",createdAt:"2026-02-22",commentCount:8,helpfulCount:19,comments:[{author:"Ms. Patel",text:"I use colored highlighting — subject in blue, verb in green. Students can physically see the connection.",time:"3 days ago"},{author:"Mr. Washington",text:"The Evidence Sort game in Grammar Spy is perfect for this. Students sort correct vs incorrect and explain why.",time:"2 days ago"}]},
{id:"p3",type:"prompt",title:"How do you use Grammar Spy for whole-class instruction?",excerpt:"Beyond individual practice — how are you projecting missions for guided instruction?",body:"Grammar Spy has a Whole Class mode where the teacher controls the pace and students vote. But many teachers are finding creative ways beyond the built-in mode.\n\nDo you project one question at a time? Use it as a warm-up? Pair students for team mode? Share your setup.",tags:["whole class","projection","strategies"],missionTag:"All Missions",gradeBand:"All Grades",createdAt:"2026-02-20",commentCount:15,helpfulCount:34,comments:[{author:"Ms. Kim",text:"I project Error Detector and we discuss each sentence as a class before anyone clicks. The 'why' conversation is where the learning happens.",time:"4 days ago"},{author:"Mr. Diaz",text:"Team mode on the big screen. Students love the split-screen competition. I give 30 seconds per question.",time:"3 days ago"},{author:"Ms. Johnson",text:"Warm-up routine: 3 questions from Clue Trail on the projector. Students write answers on whiteboards. Takes 5 minutes.",time:"1 day ago"}]},
{id:"p4",type:"announce",title:"Grammar Spy Community is Live!",excerpt:"Welcome to the Grammar Spy teacher community. Here's what to expect in Phase 1.",body:"We're excited to launch the Grammar Spy Community — a space built for teachers, by a teacher.\n\nIn Phase 1, you'll find:\n• Weekly discussion prompts about grammar instruction\n• Mission tips shared by fellow teachers\n• Teacher spotlights featuring what's working\n\nFull forums and messaging are coming in a future update. For now, this is a curated, focused space to share what works.",tags:["announcement","launch"],missionTag:"",gradeBand:"",createdAt:"2026-02-25",commentCount:3,helpfulCount:42,comments:[{author:"Mrs. Kan",text:"Welcome everyone! I built Grammar Spy because I needed it — and this community exists for the same reason. Share freely.",time:"1 day ago"}]}
];

var TIPS=[
{id:"t1",title:"Error Detector as a 5-minute warm-up",missionTag:"Mission 01",gradeBand:"Grades 7-9",content:"Project 3 Error Detector questions on the board. Students write the error on whiteboards before clicking. Quick, focused, zero prep.",authorName:"Ms. Rivera",createdAt:"2026-02-23",helpfulCount:18},
{id:"t2",title:"Timeline Sort for visual learners",missionTag:"Mission 01",gradeBand:"Grades 6-8",content:"Before playing Timeline Sort digitally, I draw a physical timeline on the board and have students sort sentence strips by hand. Then they do it on Grammar Spy. The physical-to-digital transfer helps it stick.",authorName:"Mr. Chen",createdAt:"2026-02-22",helpfulCount:14},
{id:"t3",title:"Sentence Forge for writing warm-ups",missionTag:"Mission 01",gradeBand:"Grades 8-10",content:"Students play Sentence Forge (word tile building) for 5 minutes, then immediately write 3 original sentences using the same structure. The game primes the pattern.",authorName:"Ms. Okafor",createdAt:"2026-02-21",helpfulCount:22},
{id:"t4",title:"Evidence Sort as exit ticket",missionTag:"Mission 03",gradeBand:"Grades 7-9",content:"End of class: project 4 sentences from Evidence Sort. Students sort them on paper as an exit ticket. I can see who gets agreement and who doesn't in 2 minutes.",authorName:"Mr. Washington",createdAt:"2026-02-20",helpfulCount:16},
{id:"t5",title:"Team mode for Friday reviews",missionTag:"All Missions",gradeBand:"All Grades",content:"Every Friday: Team Mode, 10 questions, 30 seconds each. Students pick teams. Losing team has to give the winning team a grammar compliment. Keeps it fun and positive.",authorName:"Ms. Kim",createdAt:"2026-02-19",helpfulCount:31},
{id:"t6",title:"CLUES archive for test prep",missionTag:"All Missions",gradeBand:"Grades 9-12",content:"Before any grammar assessment, I assign 5 CLUE cards to review. Students read the context, logic, and common trap. Better than re-teaching the whole lesson.",authorName:"Ms. Patel",createdAt:"2026-02-18",helpfulCount:12}
];

var SPOTLIGHTS=[
{id:"s1",teacherName:"Ms. Rivera",highlights:["Used Error Detector as daily warm-up for 3 weeks","Student agreement accuracy went from 62% to 84%","Students started self-correcting in writing assignments"],missionTag:"Mission 01",createdAt:"2026-02-24"},
{id:"s2",teacherName:"Mr. Chen",highlights:["Introduced Timeline Sort to newcomer ELD class","Students with no English could participate using visual cues","Parent feedback: 'My child talks about grammar at home now'"],missionTag:"Mission 01",createdAt:"2026-02-22"},
{id:"s3",teacherName:"Ms. Kim",highlights:["Ran Team Mode every Friday for a month","Classroom engagement scores up 40%","Students requested grammar practice — never happened before"],missionTag:"All Missions",createdAt:"2026-02-20"}
];

var savedTips=JSON.parse(localStorage.getItem("gs_saved_tips")||"[]");
var helpedTips=JSON.parse(localStorage.getItem("gs_helped_tips")||"[]");
var helpedPosts=JSON.parse(localStorage.getItem("gs_helped_posts")||"[]");
var currentFilter="all";
var searchQuery="";
var sortBy="newest";

function openModal(id){document.getElementById(id).classList.add("open");}
function closeModal(id){document.getElementById(id).classList.remove("open");}
function showToast(msg){var t=document.getElementById("toast");t.textContent=msg;t.classList.add("show");setTimeout(function(){t.classList.remove("show");},3000);}

function submitTip(){
  if(document.getElementById("tipHoney").value)return;
  var title=document.getElementById("tipTitle").value.trim();
  var content=document.getElementById("tipContent").value.trim();
  if(!title||!content){showToast("Please fill in the title and tip.");return;}
  showToast("Thanks — your tip is pending review.");
  closeModal("tipModal");
  document.getElementById("tipTitle").value="";document.getElementById("tipContent").value="";
}
function submitReport(){showToast("Report submitted. We'll review it shortly.");closeModal("reportModal");}

function toggleHelp(type,id){
  var arr=type==="post"?helpedPosts:helpedTips;
  var idx=arr.indexOf(id);
  if(idx>=0)arr.splice(idx,1);else arr.push(id);
  localStorage.setItem(type==="post"?"gs_helped_posts":"gs_helped_tips",JSON.stringify(arr));
  render();
}
function toggleSave(id){
  var idx=savedTips.indexOf(id);
  if(idx>=0)savedTips.splice(idx,1);else savedTips.push(id);
  localStorage.setItem("gs_saved_tips",JSON.stringify(savedTips));
  render();
}
function togglePost(id){
  var body=document.getElementById("body-"+id);
  if(body)body.classList.toggle("open");
}

function render(){
  var q=searchQuery.toLowerCase();
  // POSTS
  var filtered=POSTS.filter(function(p){
    if(currentFilter!=="all"&&p.type!==currentFilter)return false;
    if(q){var blob=(p.title+" "+p.excerpt+" "+p.tags.join(" ")+" "+p.missionTag).toLowerCase();if(blob.indexOf(q)<0)return false;}
    return true;
  });
  if(sortBy==="helpful")filtered.sort(function(a,b){return b.helpfulCount-a.helpfulCount;});
  else if(sortBy==="discussed")filtered.sort(function(a,b){return b.commentCount-a.commentCount;});

  var ph=document.getElementById("promptCards");
  ph.innerHTML=filtered.length?filtered.map(function(p){
    var tagClass=p.type==="prompt"?"tag-prompt":p.type==="announce"?"tag-announce":"tag-tip";
    var helped=helpedPosts.indexOf(p.id)>=0;
    var h='<div class="post-card"><div class="post-tags"><span class="tag '+tagClass+'">'+p.type+'</span>';
    if(p.missionTag)h+='<span class="tag tag-mission">'+p.missionTag+'</span>';
    if(p.gradeBand)h+='<span class="tag tag-grade">'+p.gradeBand+'</span>';
    h+='</div><div class="post-title">'+p.title+'</div><div class="post-excerpt">'+p.excerpt+'</div>';
    h+='<div class="post-meta"><span class="post-action" onclick="toggleHelp(\'post\',\''+p.id+'\')"><svg viewBox="0 0 24 24" fill="'+(helped?"currentColor":"none")+'" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3H14z"/><path d="M7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg>'+((helped?1:0)+p.helpfulCount)+' helpful</span>';
    h+='<span><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>'+p.commentCount+' comments</span>';
    h+='<span class="report-link" onclick="openModal(\'reportModal\')">Report</span></div>';
    h+='<button class="btn btn-sm btn-secondary" style="margin-top:10px" onclick="togglePost(\''+p.id+'\')">Open Thread</button>';
    h+='<div class="post-body" id="body-'+p.id+'"><p>'+p.body.replace(/\n/g,"<br>")+'</p>';
    if(p.comments&&p.comments.length){
      h+='<div class="comments">';
      p.comments.forEach(function(c){h+='<div class="comment"><div class="comment-author">'+c.author+'</div><div class="comment-text">'+c.text+'</div><div class="comment-time">'+c.time+'</div></div>';});
      h+='<div class="comment-form"><input placeholder="Your name (optional)" style="max-width:160px"><textarea placeholder="Add a comment…"></textarea><button class="btn btn-sm btn-primary" onclick="showToast(\'Comment posted!\')">Post</button></div>';
      h+='</div>';
    }
    h+='</div></div>';
    return h;
  }).join(""):'<div class="empty">No posts match your search.</div>';

  // TIPS
  var filteredTips=TIPS.filter(function(t){
    if(currentFilter==="tip"||currentFilter==="all"){
      if(q){var blob=(t.title+" "+t.content+" "+t.missionTag).toLowerCase();return blob.indexOf(q)>=0;}
      return true;
    }
    return false;
  });
  if(sortBy==="helpful")filteredTips.sort(function(a,b){return b.helpfulCount-a.helpfulCount;});

  var tc=document.getElementById("tipCards");
  tc.innerHTML=filteredTips.map(function(t){
    var helped=helpedTips.indexOf(t.id)>=0;
    var saved=savedTips.indexOf(t.id)>=0;
    var h='<div class="tip-card"><div class="post-tags"><span class="tag tag-mission">'+t.missionTag+'</span>';
    if(t.gradeBand)h+='<span class="tag tag-grade">'+t.gradeBand+'</span>';
    h+='</div><div class="tip-title">'+t.title+'</div><div class="tip-content">'+t.content+'</div>';
    if(t.authorName)h+='<div class="tip-author">Submitted by '+t.authorName+'</div>';
    h+='<div class="tip-actions"><button class="helpful-btn'+(helped?" active":"")+'" onclick="toggleHelp(\'tip\',\''+t.id+'\')"><svg viewBox="0 0 24 24" fill="'+(helped?"currentColor":"none")+'" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3H14z"/><path d="M7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg>'+((helped?1:0)+t.helpfulCount)+'</button>';
    h+='<button class="save-btn'+(saved?" active":"")+'" onclick="toggleSave(\''+t.id+'\')"><svg viewBox="0 0 24 24" fill="'+(saved?"currentColor":"none")+'" stroke="currentColor" stroke-width="2"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>'+(saved?"Saved":"Save")+'</button>';
    h+='<span class="report-link" onclick="openModal(\'reportModal\')">Report</span></div></div>';
    return h;
  }).join("");

  // SPOTLIGHTS
  var sc=document.getElementById("spotlightCards");
  sc.innerHTML=SPOTLIGHTS.map(function(s){
    var initials=s.teacherName.split(" ").map(function(w){return w[0];}).join("");
    var h='<div class="spotlight-card"><div class="spotlight-avatar">'+initials+'</div>';
    h+='<div class="spotlight-name">'+s.teacherName+'</div>';
    if(s.missionTag)h+='<div style="margin-top:4px"><span class="tag tag-mission">'+s.missionTag+'</span></div>';
    h+='<ul class="spotlight-list">';
    s.highlights.forEach(function(hl){h+='<li>'+hl+'</li>';});
    h+='</ul></div>';
    return h;
  }).join("");

  // Count
  var total=filtered.length+filteredTips.length;
  document.getElementById("resultCount").textContent=total+" result"+(total!==1?"s":"");

  // Section visibility
  document.getElementById("tips").style.display=(currentFilter==="all"||currentFilter==="tip")?"block":"none";
  document.getElementById("spotlights").style.display=(currentFilter==="all"||currentFilter==="spotlight")?"block":"none";
}

// Filter chips
document.querySelectorAll(".chip").forEach(function(c){
  c.addEventListener("click",function(){
    document.querySelectorAll(".chip").forEach(function(x){x.classList.remove("active");});
    c.classList.add("active");
    currentFilter=c.dataset.filter;
    render();
  });
});
document.getElementById("searchInput").addEventListener("input",function(e){searchQuery=e.target.value;render();});
document.getElementById("sortSelect").addEventListener("change",function(e){sortBy=e.target.value;render();});

render();
</script>
</body>
</html>
