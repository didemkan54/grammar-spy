<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Grammar Spy‚Ñ¢ ‚Äî Subject Spotter</title>
  <link rel="icon" type="image/svg+xml" href="../assets/brand/favicon.svg" />
  <link rel="stylesheet" href="../game-ui.css" />
  <style>
    /* Scene context */
    .scene-context{background:linear-gradient(135deg,var(--teal-light),#f0f8f9);border:1px solid rgba(31,95,99,.15);border-radius:12px;padding:16px 18px;margin-bottom:12px}
    .scene-context .scene-icon{font-size:24px;margin-right:10px}
    .scene-context .scene-text{font-size:14px;color:var(--slate);line-height:1.5}
    .scene-context .scene-label{font-size:11px;font-weight:800;text-transform:uppercase;letter-spacing:.1em;color:var(--teal);margin-bottom:4px}

    /* Sentence display */
    .sentence-display{font-size:20px;line-height:2;color:var(--mid);font-weight:600;padding:14px 0;text-align:center}
    .sentence-word{display:inline-block;padding:4px 8px;margin:2px;border-radius:8px;cursor:default;transition:background .15s,color .15s,box-shadow .15s,transform .12s}
    .sentence-word.clickable{cursor:pointer}
    .sentence-word.clickable:hover{background:var(--teal-light);transform:translateY(-1px)}
    .sentence-word.highlighted{background:var(--teal-light);color:var(--teal);font-weight:700;border:2px solid rgba(31,95,99,.25);box-shadow:0 0 10px rgba(31,95,99,.2)}
    .sentence-word.subject-found{background:var(--teal);color:#fff;font-weight:700;box-shadow:0 0 12px rgba(31,95,99,.35);animation:gs-subject-glow 1.2s ease infinite}
    .sentence-word.subject-wrong{background:var(--bad-bg);color:var(--bad);font-weight:700;border:2px solid var(--bad)}
    .sentence-word.dimmed{opacity:.45;color:var(--slate)}
    .sentence-word.blank-slot{border-bottom:3px solid var(--gold);color:var(--gold);font-weight:800;min-width:60px;display:inline-flex;justify-content:center}

    @keyframes gs-subject-glow{0%,100%{box-shadow:0 0 8px rgba(31,95,99,.25)}50%{box-shadow:0 0 18px rgba(31,95,99,.5)}}

    /* Verb choice buttons */
    .verb-choices{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin:12px 0}
    .verb-btn{display:inline-flex;align-items:center;justify-content:center;padding:12px 28px;background:#fff;border:2px solid var(--line);border-radius:12px;font-size:17px;font-weight:700;cursor:pointer;transition:border-color .15s,background .15s,transform .12s,box-shadow .15s;color:var(--mid)}
    .verb-btn:hover{border-color:var(--teal);background:var(--teal-light);transform:translateY(-2px);box-shadow:0 3px 10px rgba(31,95,99,.12)}
    .verb-btn.correct{border-color:var(--ok);background:var(--ok-bg);color:var(--ok)}
    .verb-btn.wrong{border-color:var(--bad);background:var(--bad-bg);color:var(--bad)}
    .verb-btn:disabled{opacity:.5;cursor:default;transform:none}

    /* Subject instruction */
    .subject-instruction{text-align:center;font-size:13px;font-weight:700;color:var(--teal);text-transform:uppercase;letter-spacing:.08em;margin:8px 0;padding:8px 14px;background:var(--teal-light);border-radius:8px}

    /* Director reasoning */
    .reasoning-wrap{margin:10px 0}
    .reasoning-wrap label{display:block;font-size:12px;font-weight:700;color:var(--teal);text-transform:uppercase;letter-spacing:.08em;margin-bottom:6px}
    .reasoning-input{width:100%;padding:10px 14px;border:2px solid var(--line);border-radius:10px;font-size:14px;font-family:Inter,"Segoe UI",sans-serif;resize:vertical;min-height:56px;transition:border-color .15s}
    .reasoning-input:focus{outline:none;border-color:var(--teal)}

    @media(max-width:700px){.sentence-display{font-size:16px}.verb-btn{padding:10px 20px;font-size:15px}}
  </style>
</head>
<body>
<div data-include="header" data-base="../"></div>
<main class="wrap">
  <section class="panel">
    <p class="k" id="packLabel">New Mission ¬∑ Subject-Verb Agreement</p>
    <h1>Subject Spotter</h1>
    <p class="sub">Tricky noun phrases hide the true subject. Find it, then pick the verb that agrees.</p>
    <div class="progress-bar"><div class="progress-bar-fill" id="progressBar" style="width:0%"></div></div>
    <div class="hud">
      <div class="chip"><b>Round</b><span id="hudCase">1/4</span></div>
      <div class="chip"><b>Accuracy</b><span id="hudAcc">0%</span></div>
      <div class="chip"><b>Streak</b><span id="hudStreak">0</span></div>
      <div class="chip"><b>Timer</b><span id="hudTimer">Off</span></div>
    </div>

    <div id="gameArea">
      <div class="scene-context" id="sceneCtx">
        <div class="scene-label" id="sceneLabel">Classroom Rule</div>
        <div><span class="scene-icon" id="sceneIcon">üè´</span><span class="scene-text" id="sceneText"></span></div>
      </div>
      <div class="subject-instruction" id="instruction"></div>
      <div class="sentence-display" id="sentenceDisplay"></div>
      <div class="verb-choices" id="verbChoices"></div>
      <div class="reasoning-wrap" id="reasoningWrap" style="display:none">
        <label for="reasoningInput">Explain your reasoning</label>
        <textarea class="reasoning-input" id="reasoningInput" placeholder="Why does this verb agree with the subject?"></textarea>
      </div>
    </div>
    <p class="feedback" id="feedback"></p>
    <div class="row">
      <button class="btn" id="endBtn" type="button">End Mission</button>
      <button class="btn" id="hintBtn" type="button">Hint (2 left)</button>
      <button class="btn" id="btnSound" type="button">Sound: ON</button>
      <a class="btn" href="../index.html">Home</a>
    </div>
  </section>
</main>

<!-- Onboarding -->
<div id="onboardOverlay" class="overlay show" role="dialog" aria-modal="true">
  <section class="modal" style="max-width:540px">
    <div class="onboard-difficulty diff-field" id="diffBadge">Field Agent</div>
    <h2 class="onboard-title">Subject Spotter</h2>
    <p class="onboard-subtitle">Prepositional phrases, collective nouns, and tricky pronouns can hide the true subject. Your mission: find it and match the verb.</p>
    <div class="onboard-steps">
      <div class="onboard-step">
        <div class="onboard-step-num">1</div>
        <div class="onboard-step-text"><strong>Read the sentence.</strong> A scene card shows a school announcement, text message, or classroom rule. The verb is missing ‚Äî but first, find the true subject.</div>
      </div>
      <div class="onboard-step">
        <div class="onboard-step-num">2</div>
        <div class="onboard-step-text"><strong>Identify the subject.</strong> Ignore words between the subject and verb ‚Äî prepositional phrases are distractors! The true subject glows teal.</div>
      </div>
      <div class="onboard-step">
        <div class="onboard-step-num">3</div>
        <div class="onboard-step-text"><strong>Pick the verb</strong> that agrees with the true subject. Singular subjects take singular verbs; plural subjects take plural verbs.</div>
      </div>
    </div>
    <div class="onboard-tip">
      <span class="onboard-tip-icon">üí°</span>
      <span><strong>Key rule:</strong> The subject of a sentence is never inside a prepositional phrase. "A box of markers" ‚Üí the subject is "box" (singular).</span>
    </div>
    <button class="onboard-start" id="startBtn" type="button">Start Mission</button>
  </section>
</div>

<!-- Mission Report -->
<div class="overlay" id="reportOverlay">
  <section class="modal">
    <h2 style="margin:0">Mission Report</h2>
    <p id="reportAcc"></p>
    <p id="reportScore"></p>
    <p id="reportRec"></p>
    <div class="box" id="reportInsight"></div>
    <div class="row" style="margin-top:14px">
      <button class="btn primary" id="replayBtn" type="button">Play Again</button>
      <a class="btn" href="../index.html">Home</a>
    </div>
  </section>
</div>

<div data-include="footer" data-base="../"></div>
<script src="../billing-scaffold.js"></script>
<script src="../auth-scaffold.js"></script>
<script src="../layout-loader.js"></script>
<script src="../app-shell.js"></script>
<script src="../game-sound.js"></script>
<script src="../gs-animations.js"></script>
<script>
(function(){
  // ‚îÄ‚îÄ Item Bank ‚îÄ‚îÄ
  var ITEMS = [
    // Rookie (subject pre-highlighted, pick verb)
    {id:"r1",scene:"Classroom Supply Check",icon:"üì¶",context:"The teacher is checking supplies before the art lesson starts.",
     sentence:"A box of markers ___ on the table.",
     words:["A","box","of","markers","___","on","the","table."],
     subjectWords:[1],
     verbOptions:["is","are","was","were"],answer:"is",
     explain:"The subject is \"box\" (singular), not \"markers.\" The prepositional phrase \"of markers\" is a distractor.",
     level:"rookie",tags:["prepositional_phrase"]},
    {id:"r2",scene:"Grading Time",icon:"üìù",context:"A message from Mrs. Rivera to her teaching assistant.",
     sentence:"The stack of papers ___ ready to be graded.",
     words:["The","stack","of","papers","___","ready","to","be","graded."],
     subjectWords:[1],
     verbOptions:["is","are","was","were"],answer:"is",
     explain:"The subject is \"stack\" (singular). \"Of papers\" is a prepositional phrase ‚Äî ignore it for agreement.",
     level:"rookie",tags:["prepositional_phrase"]},
    {id:"r3",scene:"Bell Schedule Announcement",icon:"üîî",context:"Morning announcement over the school intercom.",
     sentence:"The students in the hallway ___ waiting for the bell.",
     words:["The","students","in","the","hallway","___","waiting","for","the","bell."],
     subjectWords:[1],
     verbOptions:["is","are","was","were"],answer:"are",
     explain:"The subject is \"students\" (plural). \"In the hallway\" is a prepositional phrase.",
     level:"rookie",tags:["prepositional_phrase"]},
    {id:"r4",scene:"School Renovation Update",icon:"üé®",context:"Text message from the principal to parents about the new paint.",
     sentence:"The color of the walls ___ bright and cheerful.",
     words:["The","color","of","the","walls","___","bright","and","cheerful."],
     subjectWords:[1],
     verbOptions:["is","are","has","have"],answer:"is",
     explain:"The subject is \"color\" (singular). \"Of the walls\" describes which color but doesn't change the subject.",
     level:"rookie",tags:["prepositional_phrase"]},

    // Field Agent (click subject first, then pick verb)
    {id:"f1",scene:"Homework Board",icon:"üìã",context:"The class rep posted an update on the homework board.",
     sentence:"The list of assignments ___ posted on the board.",
     words:["The","list","of","assignments","___","posted","on","the","board."],
     subjectWords:[1],
     verbOptions:["was","were","has","have"],answer:"was",
     explain:"The subject is \"list\" (singular). \"Of assignments\" is a prepositional phrase. Singular subject ‚Üí \"was.\"",
     level:"field",tags:["prepositional_phrase"]},
    {id:"f2",scene:"Lab Report Discussion",icon:"üî¨",context:"The science teacher shared the results with the class.",
     sentence:"The results of the experiment ___ surprising.",
     words:["The","results","of","the","experiment","___","surprising."],
     subjectWords:[1],
     verbOptions:["was","were","is","are"],answer:"were",
     explain:"The subject is \"results\" (plural). \"Of the experiment\" is a prepositional phrase. Plural subject ‚Üí \"were.\"",
     level:"field",tags:["prepositional_phrase"]},
    {id:"f3",scene:"Field Trip Permission",icon:"üöå",context:"Classroom rule posted on the bulletin board.",
     sentence:"The teacher along with her students ___ going on a field trip.",
     words:["The","teacher","along","with","her","students","___","going","on","a","field","trip."],
     subjectWords:[1],
     verbOptions:["is","are","was","were"],answer:"is",
     explain:"The subject is \"teacher\" (singular). \"Along with her students\" is a modifying phrase, not part of the subject.",
     level:"field",tags:["intervening_phrase"]},
    {id:"f4",scene:"Science Journal Update",icon:"üì∞",context:"A headline in the school's science newsletter.",
     sentence:"A group of scientists ___ published the findings.",
     words:["A","group","of","scientists","___","published","the","findings."],
     subjectWords:[1],
     verbOptions:["has","have","is","are"],answer:"has",
     explain:"The subject is \"group\" (singular collective noun). \"Of scientists\" is a prepositional phrase. ‚Üí \"has.\"",
     level:"field",tags:["collective_noun"]},

    // Director (no highlights ‚Äî find subject AND pick verb, write reasoning)
    {id:"d1",scene:"Assembly Planning",icon:"üé§",context:"The vice-principal's email about assembly readiness.",
     sentence:"Neither the teacher nor the students ___ ready for the assembly.",
     words:["Neither","the","teacher","nor","the","students","___","ready","for","the","assembly."],
     subjectWords:[5],
     verbOptions:["was","were","is","are"],answer:"were",
     explain:"With \"neither‚Ä¶nor,\" the verb agrees with the nearer subject ‚Äî \"students\" (plural) ‚Üí \"were.\"",
     level:"director",tags:["neither_nor"]},
    {id:"d2",scene:"Project Deadline",icon:"üìÅ",context:"Announcement on the school learning portal.",
     sentence:"Every one of the projects ___ completed on time.",
     words:["Every","one","of","the","projects","___","completed","on","time."],
     subjectWords:[0,1],
     verbOptions:["was","were","has","have"],answer:"was",
     explain:"\"Every one\" is singular (it means each individual one). \"Of the projects\" is a prepositional phrase. ‚Üí \"was.\"",
     level:"director",tags:["indefinite_pronoun"]},
    {id:"d3",scene:"Student Council Vote",icon:"üó≥Ô∏è",context:"A text message between student council members.",
     sentence:"The committee ___ divided on the new dress code policy.",
     words:["The","committee","___","divided","on","the","new","dress","code","policy."],
     subjectWords:[1],
     verbOptions:["was","were","is","are"],answer:"was",
     explain:"\"Committee\" is a collective noun acting as a single unit here. ‚Üí \"was.\" (If members act individually, \"were\" could work.)",
     level:"director",tags:["collective_noun"]},
    {id:"d4",scene:"Permission Slips",icon:"‚úâÔ∏è",context:"Classroom rule displayed above the teacher's desk.",
     sentence:"Each of the students ___ submitted a permission slip.",
     words:["Each","of","the","students","___","submitted","a","permission","slip."],
     subjectWords:[0],
     verbOptions:["has","have","was","were"],answer:"has",
     explain:"\"Each\" is singular, even though \"students\" is plural. \"Of the students\" is a prepositional phrase. ‚Üí \"has.\"",
     level:"director",tags:["indefinite_pronoun"]}
  ];

  // ‚îÄ‚îÄ State ‚îÄ‚îÄ
  var q = new URLSearchParams(location.search);
  var difficulty = q.get('difficulty') || 'field';
  var count = Math.max(4, Math.min(12, Number(q.get('count') || 4)));
  var timerOn = (q.get('timer') || 'off') !== 'off';
  var rounds = [], idx = 0, correct = 0, streak = 0, score = 0, locked = false, hints = 2;
  var subjectSelected = false;

  // ‚îÄ‚îÄ DOM ‚îÄ‚îÄ
  var hudCase = document.getElementById('hudCase');
  var hudAcc = document.getElementById('hudAcc');
  var hudStreak = document.getElementById('hudStreak');
  var hudTimer = document.getElementById('hudTimer');
  var progressBar = document.getElementById('progressBar');
  var feedback = document.getElementById('feedback');
  var sentenceDisplay = document.getElementById('sentenceDisplay');
  var verbChoices = document.getElementById('verbChoices');
  var instruction = document.getElementById('instruction');
  var sceneText = document.getElementById('sceneText');
  var sceneIcon = document.getElementById('sceneIcon');
  var sceneLabel = document.getElementById('sceneLabel');
  var reasoningWrap = document.getElementById('reasoningWrap');
  var reasoningInput = document.getElementById('reasoningInput');

  // ‚îÄ‚îÄ Difficulty badge ‚îÄ‚îÄ
  var badge = document.getElementById('diffBadge');
  if (badge) {
    badge.className = 'onboard-difficulty diff-' + difficulty;
    badge.textContent = difficulty === 'rookie' ? 'Rookie' : difficulty === 'director' ? 'Director' : 'Field Agent';
  }

  // ‚îÄ‚îÄ Init ‚îÄ‚îÄ
  function shuffle(arr) { var a = arr.slice(); for (var i = a.length - 1; i > 0; i--) { var j = Math.floor(Math.random() * (i + 1)); var t = a[i]; a[i] = a[j]; a[j] = t; } return a; }

  function buildRounds() {
    var pool = ITEMS.filter(function(item) { return item.level === difficulty; });
    if (!pool.length) pool = ITEMS.filter(function(item) { return item.level === 'rookie'; });
    rounds = shuffle(pool).slice(0, Math.min(count, pool.length));
  }

  function updateHud() {
    hudCase.textContent = Math.min(idx + 1, rounds.length) + '/' + rounds.length;
    hudAcc.textContent = Math.round((correct / Math.max(1, idx)) * 100) + '%';
    hudStreak.textContent = String(streak);
    hudTimer.textContent = timerOn ? 'On' : 'Off';
    progressBar.style.width = Math.round((idx / Math.max(1, rounds.length)) * 100) + '%';
  }

  function showFeedback(isCorrect, explain) {
    if (isCorrect) {
      feedback.innerHTML = '<span class="ok"><b>Correct!</b> ' + explain + '</span>';
      if (window.GSSound && window.GSSound.correct) window.GSSound.correct();
    } else {
      feedback.innerHTML = '<span class="bad"><b>Not quite.</b> ' + explain + '</span>';
      if (window.GSSound && window.GSSound.wrong) window.GSSound.wrong();
    }
  }

  // ‚îÄ‚îÄ Render sentence words ‚îÄ‚îÄ
  function renderSentence(item, onSubjectClick) {
    sentenceDisplay.innerHTML = '';
    item.words.forEach(function(word, wi) {
      var span = document.createElement('span');
      span.textContent = word === '___' ? '___' : word;
      span.dataset.idx = wi;

      if (word === '___') {
        span.className = 'sentence-word blank-slot';
      } else if (difficulty === 'rookie' && item.subjectWords.indexOf(wi) >= 0) {
        span.className = 'sentence-word highlighted';
      } else if (difficulty !== 'rookie' && word !== '___') {
        span.className = 'sentence-word clickable';
        if (onSubjectClick) {
          span.addEventListener('click', function() { onSubjectClick(wi, span); });
        }
      } else {
        span.className = 'sentence-word';
      }
      sentenceDisplay.appendChild(span);
      sentenceDisplay.appendChild(document.createTextNode(' '));
    });
  }

  function dimDistractors(item) {
    var spans = sentenceDisplay.querySelectorAll('.sentence-word');
    spans.forEach(function(s, i) {
      if (item.subjectWords.indexOf(i) < 0 && s.textContent !== '___') {
        s.classList.add('dimmed');
      }
    });
  }

  // ‚îÄ‚îÄ Render verb options ‚îÄ‚îÄ
  function renderVerbs(item) {
    verbChoices.innerHTML = '';
    item.verbOptions.forEach(function(verb) {
      var btn = document.createElement('button');
      btn.className = 'verb-btn';
      btn.type = 'button';
      btn.textContent = verb;
      btn.addEventListener('click', function() {
        if (locked) return;
        if (difficulty === 'director') {
          locked = true;
          idx++;
          var isCorrect = verb === item.answer;
          if (isCorrect) { correct++; streak++; score += 150; btn.classList.add('correct'); }
          else { streak = 0; btn.classList.add('wrong'); verbChoices.querySelectorAll('.verb-btn').forEach(function(b) { if (b.textContent === item.answer) b.classList.add('correct'); }); }
          highlightTrueSubject(item);
          dimDistractors(item);
          var reasoning = reasoningInput ? reasoningInput.value.trim() : '';
          var extra = reasoning ? '<br><em>Your reasoning:</em> "' + reasoning.replace(/</g,'&lt;') + '"' : '';
          showFeedback(isCorrect, item.explain + extra);
          setTimeout(showRound, 2000);
        } else {
          locked = true;
          idx++;
          var isCorrect = verb === item.answer;
          if (isCorrect) { correct++; streak++; score += difficulty === 'field' ? 120 : 100; btn.classList.add('correct'); }
          else { streak = 0; btn.classList.add('wrong'); verbChoices.querySelectorAll('.verb-btn').forEach(function(b) { if (b.textContent === item.answer) b.classList.add('correct'); }); }
          highlightTrueSubject(item);
          dimDistractors(item);
          showFeedback(isCorrect, item.explain);
          setTimeout(showRound, 1500);
        }
      });
      verbChoices.appendChild(btn);
    });
  }

  function highlightTrueSubject(item) {
    var spans = sentenceDisplay.querySelectorAll('.sentence-word');
    item.subjectWords.forEach(function(si) {
      if (spans[si]) { spans[si].className = 'sentence-word subject-found'; }
    });
  }

  // ‚îÄ‚îÄ Show Round ‚îÄ‚îÄ
  function showRound() {
    if (idx >= rounds.length) { endGame(); return; }
    locked = false;
    subjectSelected = false;
    feedback.textContent = '';
    verbChoices.innerHTML = '';
    reasoningWrap.style.display = 'none';
    if (reasoningInput) reasoningInput.value = '';
    var item = rounds[idx];

    sceneText.textContent = item.context;
    sceneIcon.textContent = item.icon;
    sceneLabel.textContent = item.scene;

    if (difficulty === 'rookie') {
      instruction.textContent = 'üéØ The subject is highlighted in teal. Pick the correct verb.';
      renderSentence(item, null);
      renderVerbs(item);
    } else if (difficulty === 'field') {
      instruction.textContent = 'üîç Click the TRUE subject first, then pick the verb.';
      renderSentence(item, function(wi, span) {
        if (locked || subjectSelected) return;
        subjectSelected = true;
        if (item.subjectWords.indexOf(wi) >= 0) {
          span.className = 'sentence-word subject-found';
          score += 20;
        } else {
          span.className = 'sentence-word subject-wrong';
          highlightTrueSubject(item);
        }
        dimDistractors(item);
        renderVerbs(item);
      });
    } else {
      instruction.textContent = 'üïµÔ∏è No hints! Find the subject, pick the verb, and explain why.';
      reasoningWrap.style.display = 'block';
      renderSentence(item, function(wi, span) {
        if (locked || subjectSelected) return;
        subjectSelected = true;
        if (item.subjectWords.indexOf(wi) >= 0) {
          span.className = 'sentence-word subject-found';
          score += 30;
        } else {
          span.className = 'sentence-word subject-wrong';
          highlightTrueSubject(item);
        }
        dimDistractors(item);
        renderVerbs(item);
      });
    }
    updateHud();
  }

  // ‚îÄ‚îÄ End Game ‚îÄ‚îÄ
  function endGame() {
    var acc = Math.round((correct / Math.max(1, idx)) * 100);
    document.getElementById('reportAcc').textContent = 'Accuracy: ' + acc + '% (' + correct + '/' + idx + ')';
    document.getElementById('reportScore').textContent = 'Score: ' + score + ' pts';
    document.getElementById('reportRec').textContent = acc >= 80 ? 'Recommendation: Advance to the next difficulty!' : 'Recommendation: Replay to sharpen your subject-spotting skills.';
    document.getElementById('reportInsight').innerHTML = '<div class="skill-label" style="color:var(--teal)">GRAMMAR INSIGHT</div>' +
      '<p style="margin:6px 0 0;font-size:13px;line-height:1.6">The <strong>subject</strong> of a sentence is never inside a prepositional phrase. With "neither‚Ä¶nor," the verb agrees with the <strong>nearer</strong> subject. Collective nouns and indefinite pronouns like "each" and "every one" are <strong>singular</strong>.</p>';
    document.getElementById('reportOverlay').classList.add('show');
    if (window.GSSound && window.GSSound.missionComplete) window.GSSound.missionComplete();
  }

  // ‚îÄ‚îÄ Hint ‚îÄ‚îÄ
  document.getElementById('hintBtn').addEventListener('click', function() {
    if (hints <= 0 || locked) return;
    hints--;
    document.getElementById('hintBtn').textContent = 'Hint (' + hints + ' left)';
    score = Math.max(0, score - 30);
    var item = rounds[idx];
    if (item) {
      feedback.innerHTML = '<span class="ok">üí° Hint: The true subject is <strong>"' + item.subjectWords.map(function(i) { return item.words[i]; }).join(' ') + '"</strong>. Is it singular or plural?</span>';
    }
  });

  // ‚îÄ‚îÄ Start ‚îÄ‚îÄ
  document.getElementById('startBtn').addEventListener('click', function() {
    document.getElementById('onboardOverlay').classList.remove('show');
    buildRounds();
    showRound();
  });
  document.getElementById('endBtn').addEventListener('click', function() { idx = rounds.length; endGame(); });
  document.getElementById('replayBtn').addEventListener('click', function() {
    document.getElementById('reportOverlay').classList.remove('show');
    idx = 0; correct = 0; streak = 0; score = 0; hints = 2;
    document.getElementById('hintBtn').textContent = 'Hint (2 left)';
    buildRounds();
    showRound();
  });

  if (!timerOn) hudTimer.textContent = 'Off';
})();
</script>
</body>
</html>
